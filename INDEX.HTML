<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutrition Health Assistant - H·ªó tr·ª£ ƒÉn u·ªëng theo b·ªánh l√Ω</title>
    <style>
        /* ==================== RESET & BASE STYLES ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        /* ==================== HEADER ==================== */
        header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #10b981;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        nav a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav a:hover {
            color: #10b981;
        }

        /* ==================== MAIN CONTAINER ==================== */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* ==================== SECTION CARDS ==================== */
        .section-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.5rem;
            color: #10b981;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 30px;
            background: #10b981;
            border-radius: 2px;
        }

        /* ==================== DISEASE INPUT SECTION ==================== */
        .disease-input-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .disease-input {
            flex: 1;
            padding: 0.8rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .disease-input:focus {
            outline: none;
            border-color: #10b981;
        }

        .disease-select {
            padding: 0.8rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            min-width: 200px;
            cursor: pointer;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #10b981;
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-secondary {
            background: #6366f1;
            color: white;
        }

        .btn-secondary:hover {
            background: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* ==================== DISEASE TAGS ==================== */
        .disease-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .disease-tag {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            animation: fadeIn 0.3s;
        }

        .disease-tag .remove-tag {
            cursor: pointer;
            font-weight: bold;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .disease-tag .remove-tag:hover {
            opacity: 1;
        }

        /* ==================== FOOD CHECK SECTION ==================== */
        .food-check-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        /* ==================== UPLOAD SECTION ==================== */
        .upload-area {
            border: 3px dashed #10b981;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f0fdf4;
        }

        .upload-area:hover {
            background: #dcfce7;
            border-color: #059669;
        }

        .upload-area input[type="file"] {
            display: none;
        }

        .upload-icon {
            font-size: 3rem;
            color: #10b981;
            margin-bottom: 1rem;
        }

        .preview-container {
            margin-top: 1rem;
            text-align: center;
        }

        .preview-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* ==================== CAMERA SECTION ==================== */
        .camera-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .camera-view {
            position: relative;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
        }

        #webcam {
            width: 100%;
            border-radius: 12px;
        }

        #canvas {
            display: none;
            width: 100%;
            border-radius: 12px;
        }

        .camera-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        /* ==================== RESULT SECTION ==================== */
        .result-container {
            display: none;
            animation: slideIn 0.5s;
        }

        .result-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .result-icon {
            font-size: 3rem;
        }

        .result-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .result-status {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 1rem;
        }

        .status-good {
            background: #dcfce7;
            color: #059669;
        }

        .status-warning {
            background: #fef3c7;
            color: #d97706;
        }

        .status-danger {
            background: #fee2e2;
            color: #dc2626;
        }

        .result-content {
            margin-top: 1.5rem;
        }

        .result-section {
            margin-bottom: 1.5rem;
        }

        .result-section h3 {
            color: #10b981;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .result-section p {
            color: #666;
            line-height: 1.8;
        }

        .alternative-foods {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .alternative-food {
            background: #f3f4f6;
            padding: 0.4rem 1rem;
            border-radius: 15px;
            font-size: 0.9rem;
            color: #333;
        }

        /* ==================== GRID LAYOUT ==================== */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        /* ==================== ANIMATIONS ==================== */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                gap: 1rem;
            }

            .disease-input-container,
            .food-check-container {
                flex-direction: column;
            }

            .container {
                padding: 0 1rem;
            }

            .section-card {
                padding: 1.5rem;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        /* ==================== HELPER CLASSES ==================== */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-1 {
            margin-bottom: 1rem;
        }

        .mt-2 {
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <!-- ==================== HEADER ==================== -->
    <header>
        <div class="header-container">
            <div class="logo">
                <div class="logo-icon">üçé</div>
                <span>Nutrition Health Assistant</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#home">Trang ch·ªß</a></li>
                    <li><a href="#consult">T∆∞ v·∫•n</a></li>
                    <li><a href="#camera">Camera</a></li>
                    <li><a href="#about">Gi·ªõi thi·ªáu</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- ==================== MAIN CONTAINER ==================== -->
    <div class="container">
        <!-- ==================== DISEASE INPUT SECTION ==================== -->
        <div class="section-card" id="home">
            <h2 class="section-title">Nh·∫≠p b·ªánh l√Ω c·ªßa b·∫°n</h2>
            <div class="disease-input-container">
                <input 
                    type="text" 
                    id="diseaseInput" 
                    class="disease-input" 
                    placeholder="Nh·∫≠p t√™n b·ªánh l√Ω (VD: Ti·ªÉu ƒë∆∞·ªùng, Cao huy·∫øt √°p...)"
                >
                <select id="diseaseSelect" class="disease-select">
                    <option value="">-- Ch·ªçn b·ªánh l√Ω --</option>
                    <option value="ti·ªÉu ƒë∆∞·ªùng">Ti·ªÉu ƒë∆∞·ªùng</option>
                    <option value="cao huy·∫øt √°p">Cao huy·∫øt √°p</option>
                    <option value="gout">Gout</option>
                    <option value="b√©o ph√¨">B√©o ph√¨</option>
                    <option value="b·ªánh th·∫≠n">B·ªánh th·∫≠n</option>
                    <option value="tim m·∫°ch">Tim m·∫°ch</option>
                    <option value="gan nhi·ªÖm m·ª°">Gan nhi·ªÖm m·ª°</option>
                    <option value="cholesterol cao">Cholesterol cao</option>
                </select>
                <button class="btn btn-primary" onclick="addDisease()">Th√™m</button>
            </div>
            <div id="diseaseTags" class="disease-tags"></div>
        </div>

        <!-- ==================== FOOD CHECK BY TEXT ==================== -->
        <div class="section-card" id="consult">
            <h2 class="section-title">Ki·ªÉm tra m√≥n ƒÉn</h2>
            <div class="food-check-container">
                <input 
                    type="text" 
                    id="foodInput" 
                    class="disease-input" 
                    placeholder="Nh·∫≠p t√™n m√≥n ƒÉn (VD: Ph·ªü, B√°nh ng·ªçt, Th·ªãt kho...)"
                >
                <button class="btn btn-primary" onclick="checkFood()">Ki·ªÉm tra</button>
            </div>
        </div>

        <!-- ==================== GRID: UPLOAD & CAMERA ==================== -->
        <div class="grid-2">
            <!-- ==================== UPLOAD IMAGE SECTION ==================== -->
            <div class="section-card">
                <h2 class="section-title">T·∫£i ·∫£nh m√≥n ƒÉn</h2>
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">üì∑</div>
                    <p><strong>Click ƒë·ªÉ ch·ªçn ·∫£nh</strong></p>
                    <p style="color: #999; font-size: 0.9rem;">H·ªó tr·ª£: JPG, PNG, JPEG</p>
                    <input type="file" id="fileInput" accept="image/*" onchange="previewImage(event)">
                </div>
                <div id="previewContainer" class="preview-container hidden">
                    <img id="previewImg" class="preview-image" alt="Preview">
                    <br><br>
                    <button class="btn btn-primary" onclick="analyzeUploadedImage()">Ph√¢n t√≠ch ·∫£nh</button>
                </div>
            </div>

            <!-- ==================== CAMERA SECTION ==================== -->
            <div class="section-card" id="camera">
                <h2 class="section-title">Ch·ª•p ·∫£nh m√≥n ƒÉn</h2>
                <div class="camera-container">
                    <div class="camera-view">
                        <video id="webcam" autoplay playsinline></video>
                        <canvas id="canvas"></canvas>
                    </div>
                    <div class="camera-controls">
                        <button class="btn btn-secondary" onclick="startCamera()">B·∫≠t Camera</button>
                        <button class="btn btn-primary" onclick="captureImage()">Ch·ª•p ·∫£nh</button>
                        <button class="btn btn-danger" onclick="stopCamera()">T·∫Øt Camera</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== RESULT SECTION ==================== -->
        <div id="resultContainer" class="result-container section-card">
            <h2 class="section-title">K·∫øt qu·∫£ ph√¢n t√≠ch</h2>
            <div class="result-card">
                <div class="result-header">
                    <div id="resultIcon" class="result-icon">üçΩÔ∏è</div>
                    <div>
                        <div id="resultFoodName" class="result-title">T√™n m√≥n ƒÉn</div>
                        <span id="resultStatus" class="result-status status-good">‚úì N√™n ƒÉn</span>
                    </div>
                </div>
                <div class="result-content">
                    <div class="result-section">
                        <h3>üìã Ph√¢n t√≠ch dinh d∆∞·ª°ng</h3>
                        <p id="resultAnalysis">ƒêang ph√¢n t√≠ch...</p>
                    </div>
                    <div class="result-section">
                        <h3>üí° L√Ω do</h3>
                        <p id="resultReason">ƒêang t·∫£i...</p>
                    </div>
                    <div class="result-section">
                        <h3>üîÑ G·ª£i √Ω thay th·∫ø</h3>
                        <div id="resultAlternatives" class="alternative-foods"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== JAVASCRIPT ==================== -->
    <script>
        // ==================== GLOBAL VARIABLES ====================
        let userDiseases = []; // L∆∞u danh s√°ch b·ªánh l√Ω c·ªßa ng∆∞·ªùi d√πng
        let videoStream = null; // L∆∞u stream t·ª´ camera

        // ==================== DATABASE: FOOD & DISEASE RULES ====================
        const foodDatabase = {
            'ph·ªü': {
                sugar: 'low',
                salt: 'medium',
                purine: 'medium',
                calories: 'medium',
                protein: 'high'
            },
            'b√°nh ng·ªçt': {
                sugar: 'high',
                salt: 'low',
                purine: 'low',
                calories: 'high',
                protein: 'low'
            },
            'th·ªãt kho': {
                sugar: 'low',
                salt: 'high',
                purine: 'high',
                calories: 'high',
                protein: 'high'
            },
            'rau x√†o': {
                sugar: 'low',
                salt: 'low',
                purine: 'low',
                calories: 'low',
                protein: 'low'
            },
            'c∆°m tr·∫Øng': {
                sugar: 'high',
                salt: 'low',
                purine: 'low',
                calories: 'medium',
                protein: 'low'
            },
            'n∆∞·ªõc ng·ªçt': {
                sugar: 'very_high',
                salt: 'low',
                purine: 'low',
                calories: 'high',
                protein: 'low'
            },
            'h·∫£i s·∫£n': {
                sugar: 'low',
                salt: 'medium',
                purine: 'very_high',
                calories: 'medium',
                protein: 'very_high'
            },
            'salad': {
                sugar: 'low',
                salt: 'low',
                purine: 'low',
                calories: 'low',
                protein: 'low'
            }
        };

        // Rule-based system cho t·ª´ng b·ªánh
        const diseaseRules = {
            'ti·ªÉu ƒë∆∞·ªùng': {
                avoid: ['sugar_very_high', 'sugar_high'],
                warning: ['calories_high'],
                message: 'Ng∆∞·ªùi b·ªánh ti·ªÉu ƒë∆∞·ªùng c·∫ßn h·∫°n ch·∫ø ƒë∆∞·ªùng v√† tinh b·ªôt',
                alternatives: ['Rau x√†o', 'Salad', 'Th·ªãt n∆∞·ªõng kh√¥ng ƒë∆∞·ªùng']
            },
            'cao huy·∫øt √°p': {
                avoid: ['salt_very_high', 'salt_high'],
                warning: ['salt_medium'],
                message: 'Ng∆∞·ªùi cao huy·∫øt √°p c·∫ßn h·∫°n ch·∫ø mu·ªëi natri',
                alternatives: ['Rau lu·ªôc', 'C√° h·∫•p', 'Salad']
            },
            'gout': {
                avoid: ['purine_very_high'],
                warning: ['purine_high', 'purine_medium'],
                message: 'Ng∆∞·ªùi b·ªánh gout c·∫ßn tr√°nh th·ª±c ph·∫©m gi√†u purine',
                alternatives: ['Rau xanh', 'Tr·ª©ng', 'S·ªØa √≠t b√©o']
            },
            'b√©o ph√¨': {
                avoid: ['calories_very_high'],
                warning: ['calories_high'],
                message: 'C·∫ßn ki·ªÉm so√°t l∆∞·ª£ng calo n·∫°p v√†o',
                alternatives: ['Rau c·ªß qu·∫£', 'C√° lu·ªôc', 'Salad']
            },
            'b·ªánh th·∫≠n': {
                avoid: ['salt_very_high', 'protein_very_high'],
                warning: ['salt_high', 'protein_high'],
                message: 'Ng∆∞·ªùi b·ªánh th·∫≠n c·∫ßn h·∫°n ch·∫ø mu·ªëi v√† protein',
                alternatives: ['Rau lu·ªôc', 'C∆°m tr·∫Øng', 'Tr√°i c√¢y']
            },
            'tim m·∫°ch': {
                avoid: ['salt_very_high', 'calories_very_high'],
                warning: ['salt_high', 'calories_high'],
                message: 'C·∫ßn ch·∫ø ƒë·ªô ƒÉn √≠t mu·ªëi v√† √≠t b√©o',
                alternatives: ['C√° h·ªìi', 'Rau xanh', 'Y·∫øn m·∫°ch']
            },
            'gan nhi·ªÖm m·ª°': {
                avoid: ['calories_very_high'],
                warning: ['calories_high'],
                message: 'C·∫ßn gi·∫£m ch·∫•t b√©o v√† ki·ªÉm so√°t calo',
                alternatives: ['Rau c·ªß', 'C√° tr·∫Øng', 'Ng≈© c·ªëc nguy√™n h·∫°t']
            },
            'cholesterol cao': {
                avoid: ['calories_very_high'],
                warning: ['calories_high'],
                message: 'C·∫ßn h·∫°n ch·∫ø ch·∫•t b√©o b√£o h√≤a',
                alternatives: ['C√°', 'ƒê·∫≠u', 'Rau xanh']
            }
        };

        // ==================== DISEASE MANAGEMENT ====================
        function addDisease() {
            const input = document.getElementById('diseaseInput').value.trim().toLowerCase();
            const select = document.getElementById('diseaseSelect').value;
            const disease = input || select;

            if (disease && !userDiseases.includes(disease)) {
                userDiseases.push(disease);
                renderDiseaseTags();
                document.getElementById('diseaseInput').value = '';
                document.getElementById('diseaseSelect').value = '';
            }
        }

        function removeDisease(disease) {
            userDiseases = userDiseases.filter(d => d !== disease);
            renderDiseaseTags();
        }

        function renderDiseaseTags() {
            const container = document.getElementById('diseaseTags');
            container.innerHTML = '';
            
            userDiseases.forEach(disease => {
                const tag = document.createElement('div');
                tag.className = 'disease-tag';
                tag.innerHTML = `
                    <span>${disease.charAt(0).toUpperCase() + disease.slice(1)}</span>
                    <span class="remove-tag" onclick="removeDisease('${disease}')">‚úï</span>
                `;
                container.appendChild(tag);
            });
        }

        // ==================== FOOD ANALYSIS ENGINE ====================
        function analyzeFood(foodName) {
            if (userDiseases.length === 0) {
                return {
                    status: 'warning',
                    icon: '‚ö†Ô∏è',
                    analysis: 'B·∫°n ch∆∞a nh·∫≠p b·ªánh l√Ω c·ªßa m√¨nh',
                    reason: 'Vui l√≤ng nh·∫≠p b·ªánh l√Ω ƒë·ªÉ nh·∫≠n t∆∞ v·∫•n ch√≠nh x√°c h∆°n',
                    alternatives: []
                };
            }

            const foodLower = foodName.toLowerCase();
            let foodData = null;

            // T√¨m m√≥n ƒÉn trong database
            for (let key in foodDatabase) {
                if (foodLower.includes(key)) {
                    foodData = foodDatabase[key];
                    break;
                }
            }

            // N·∫øu kh√¥ng t√¨m th·∫•y, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
            if (!foodData) {
                return {
                    status: 'warning',
                    icon: '‚ùì',
                    analysis: 'Ch∆∞a c√≥ d·ªØ li·ªáu chi ti·∫øt v·ªÅ m√≥n ƒÉn n√†y',
                    reason: 'H·ªá th·ªëng ch∆∞a c√≥ th√¥ng tin dinh d∆∞·ª°ng ƒë·∫ßy ƒë·ªß. N√™n tham kh·∫£o √Ω ki·∫øn b√°c sƒ© dinh d∆∞·ª°ng.',
                    alternatives: ['Rau xanh', 'C√° h·∫•p', 'Salad']
                };
            }

            // Ph√¢n t√≠ch theo t·ª´ng b·ªánh
            let worstStatus = 'good'; // good, warning, danger
            let reasons = [];
            let allAlternatives = [];

            userDiseases.forEach(disease => {
                const rule = diseaseRules[disease];
                if (!rule) return;

                // Ki·ªÉm tra c√°c ch·ªâ s·ªë nguy hi·ªÉm
                for (let nutrient in foodData) {
                    const level = foodData[nutrient];
                    const checkKey = `${nutrient}_${level}`;

                    if (rule.avoid && rule.avoid.includes(checkKey)) {
                        worstStatus = 'danger';
                        reasons.push(`‚õî ${nutrient.toUpperCase()} qu√° cao - Kh√¥ng ph√π h·ª£p v·ªõi ${disease}`);
                    } else if (rule.warning && rule.warning.includes(checkKey)) {
                        if (worstStatus !== 'danger') worstStatus = 'warning';
                        reasons.push(`‚ö†Ô∏è ${nutrient.toUpperCase()} ·ªü m·ª©c c·∫£nh b√°o cho ${disease}`);
                    }
                }

                if (rule.alternatives) {
                    allAlternatives = [...allAlternatives, ...rule.alternatives];
                }
            });

            // Lo·∫°i b·ªè alternatives tr√πng l·∫∑p
            allAlternatives = [...new Set(allAlternatives)];

            // T·∫°o k·∫øt qu·∫£
            let result = {
                status: worstStatus,
                icon: worstStatus === 'good' ? '‚úÖ' : worstStatus === 'warning' ? '‚ö†Ô∏è' : '‚ùå',
                analysis: `M√≥n ƒÉn n√†y ${worstStatus === 'good' ? 'ph√π h·ª£p' : worstStatus === 'warning' ? 'n√™n h·∫°n ch·∫ø' : 'kh√¥ng ph√π h·ª£p'} v·ªõi b·ªánh l√Ω c·ªßa b·∫°n`,
                reason: reasons.length > 0 ? reasons.join('\n') : '‚úì M√≥n ƒÉn n√†y an to√†n cho t√¨nh tr·∫°ng s·ª©c kh·ªèe c·ªßa b·∫°n',
                alternatives: allAlternatives.slice(0, 5)
            };

            return result;
        }

        // ==================== DISPLAY RESULT ====================
        function displayResult(foodName, analysis) {
            const container = document.getElementById('resultContainer');
            const statusClass = analysis.status === 'good' ? 'status-good' : 
                               analysis.status === 'warning' ? 'status-warning' : 'status-danger';
            
            const statusText = analysis.status === 'good' ? '‚úì N√™n ƒÉn' : 
                              analysis.status === 'warning' ? '‚ö† H·∫°n ch·∫ø' : '‚úó Kh√¥ng n√™n';

            document.getElementById('resultIcon').textContent = analysis.icon;
            document.getElementById('resultFoodName').textContent = foodName;
            document.getElementById('resultStatus').className = `result-status ${statusClass}`;
            document.getElementById('resultStatus').textContent = statusText;
            document.getElementById('resultAnalysis').textContent = analysis.analysis;
            document.getElementById('resultReason').innerHTML = analysis.reason.replace(/\n/g, '<br>');

            const alternativesContainer = document.getElementById('resultAlternatives');
            alternativesContainer.innerHTML = '';
            analysis.alternatives.forEach(alt => {
                const altDiv = document.createElement('div');
                altDiv.className = 'alternative-food';
                altDiv.textContent = alt;
                alternativesContainer.appendChild(altDiv);
            });

            container.style.display = 'block';
            container.scrollIntoView({ behavior: 'smooth' });
        }

        // ==================== CHECK FOOD BY TEXT ====================
        function checkFood() {
            const foodName = document.getElementById('foodInput').value.trim();
            
            if (!foodName) {
                alert('Vui l√≤ng nh·∫≠p t√™n m√≥n ƒÉn!');
                return;
            }

            const analysis = analyzeFood(foodName);
            displayResult(foodName, analysis);
        }

        // ==================== IMAGE UPLOAD ====================
        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('previewContainer').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function analyzeUploadedImage() {
            // Demo: Gi·∫£ l·∫≠p nh·∫≠n d·∫°ng m√≥n ƒÉn t·ª´ ·∫£nh
            const demoFoods = ['Ph·ªü', 'B√°nh ng·ªçt', 'Th·ªãt kho', 'Rau x√†o', 'C∆°m tr·∫Øng'];
            const randomFood = demoFoods[Math.floor(Math.random() * demoFoods.length)];
            
            const analysis = analyzeFood(randomFood);
            displayResult(randomFood + ' (nh·∫≠n d·∫°ng t·ª´ ·∫£nh)', analysis);
        }

        // ==================== CAMERA FUNCTIONS ====================
        async function startCamera() {
            try {
                videoStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                const video = document.getElementById('webcam');
                video.srcObject = videoStream;
                video.style.display = 'block';
                document.getElementById('canvas').style.display = 'none';
            } catch (error) {
                alert('Kh√¥ng th·ªÉ truy c·∫≠p camera: ' + error.message);
            }
        }

        function stopCamera() {
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                document.getElementById('webcam').style.display = 'none';
            }
        }

        function captureImage() {
            const video = document.getElementById('webcam');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);

            video.style.display = 'none';
            canvas.style.display = 'block';

            // Demo: Gi·∫£ l·∫≠p ph√¢n t√≠ch ·∫£nh
            setTimeout(() => {
                const demoFoods = ['Ph·ªü', 'H·∫£i s·∫£n', 'Salad', 'N∆∞·ªõc ng·ªçt'];
                const randomFood = demoFoods[Math.floor(Math.random() * demoFoods.length)];
                const analysis = analyzeFood(randomFood);
                displayResult(randomFood + ' (ch·ª•p t·ª´ camera)', analysis);
            }, 1000);
        }

        // ==================== EVENT LISTENERS ====================
        document.getElementById('diseaseInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addDisease();
            }
        });

        document.getElementById('foodInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkFood();
            }
        });

        // Smooth scroll cho navigation
        document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
    </script>
</body>
</html>