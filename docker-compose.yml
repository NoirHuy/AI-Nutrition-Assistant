version: '3.8'

services:
  # 1. Database
  neo4j:
    image: neo4j:5.16.0
    container_name: nutrition_graph
    ports:
      - "7474:7474"
      - "7687:7687"
    environment:
      - NEO4J_AUTH=neo4j/password
    volumes:
      - ./neo4j_data:/data

  # 2. Backend
  backend:
    build: ./backend
    container_name: nutrition_backend
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app
    environment:
      - NEO4J_URI=bolt://nutrition_graph:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=password
      # ğŸ‘‡ ÄIá»€N KEY Cá»¦A Báº N VÃ€O ÄÃ‚Y
      - GROQ_API_KEY=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
    depends_on:
      - neo4j

  # 3. Frontend (Cáº¥u hÃ¬nh giá»¯ nguyÃªn tÃªn folder cÅ©)
  frontend:
    build: ./frontend-diet  # ğŸ‘ˆ Trá» vÃ o thÆ° má»¥c frontend-diet
    container_name: nutrition_frontend
    ports:
      - "5173:5173"
    volumes:
      - ./frontend-diet:/app # ğŸ‘ˆ Äá»“ng bá»™ code tá»« thÆ° má»¥c nÃ y
      - /app/node_modules
    command: npm run dev -- --host
    environment:
      - CHOKIDAR_USEPOLLING=true

  # 4. Nginx Gateway
  nginx:
    image: nginx:alpine
    container_name: nutrition_gateway
    ports:
      - "80:80"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - backend
      - frontend